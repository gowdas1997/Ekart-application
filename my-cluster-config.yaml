apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  # ‡≤à ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ terminal variables ‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø
  name: ${CLUSTER_NAME}
  region: ${AWS_DEFAULT_REGION}
  version: "${K8S_VERSION}"
  tags:
    karpenter.sh/discovery: ${CLUSTER_NAME}

# --- üõë ‡≤Æ‡≥Å‡≤ñ‡≥ç‡≤Ø ‡≤¨‡≤¶‡≤≤‡≤æ‡≤µ‡≤£‡≥Ü ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø‡≤¶‡≥Ü üõë ---
# ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Ö‡≤∏‡≥ç‡≤§‡≤ø‡≤§‡≥ç‡≤µ‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø‡≤∞‡≥Å‡≤µ ‡≤®‡≥Ü‡≤ü‡≥ç‚Äå‡≤µ‡≤∞‡≥ç‡≤ï‡≥ç ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥Ä‡≤°‡≤ø
vpc:
  id: "vpc-0b8ccdd1fee0ffccc"   # <-- ‚ùóÔ∏è‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ VPC ID ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤π‡≤æ‡≤ï‡≤ø
  subnets:
    private: # Karpenter ‡≤®‡≥ã‡≤°‡≥ç‚Äå‡≤ó‡≤≥‡≤ø‡≤ó‡≤æ‡≤ó‡≤ø ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ Private Subnets
      ap-south-1a: # Availability Zone
        id: "subnet-06537e1abbc34971d" # <-- ‚ùóÔ∏è‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ Private Subnet A
      ap-south-1b: # Availability Zone
        id: "subnet-0a4d2a985dc8f9f18" # <-- ‚ùóÔ∏è‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ Private Subnet B
      # (‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤¨‡≥á‡≤ï‡≤æ‡≤¶‡≤∑‡≥ç‡≤ü‡≥Å AZ ‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å Subnet ‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤¨‡≤π‡≥Å‡≤¶‡≥Å)
    
    public: # EKS ‡≤ï‡≤Ç‡≤ü‡≥ç‡≤∞‡≥ã‡≤≤‡≥ç ‡≤™‡≥ç‡≤≤‡≥á‡≤®‡≥ç‚Äå‡≤ó‡≥Ü Public Subnets (‡≤¨‡≥á‡≤ï‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü)
      ap-south-1a:
        id: "subnet-045ddc37fb6c8797b"
      ap-south-1b:
        id: "subnet-032b6977f44494eb6"
# --- ------------------------ ---

iam:
  withOIDC: true
  podIdentityAssociations:
  - namespace: "${KARPENTER_NAMESPACE}"
    serviceAccountName: karpenter
    roleName: ${CLUSTER_NAME}-karpenter
    permissionPolicyARNs:
    - arn:${AWS_PARTITION}:iam::${AWS_ACCOUNT_ID}:policy/KarpenterControllerPolicy-${CLUSTER_NAME}

iamIdentityMappings:
- arn: "arn:${AWS_PARTITION}:iam::${AWS_ACCOUNT_ID}:role/KarpenterNodeRole-${CLUSTER_NAME}"
  username: system:node:{{EC2PrivateDNSName}}
  groups:
  - system:bootstrappers
  - system:nodes

managedNodeGroups:
- instanceType: t3.medium
  amiFamily: AmazonLinux2023
  name: ${CLUSTER_NAME}-ng
  privateNetworking: true
  desiredCapacity: 2
  minSize: 1
  maxSize: 10
  subnets:
    - "subnet-06537e1abbc34971d"
    - "subnet-0a4d2a985dc8f9f18"
  securityGroups:
    attachIDs:
      - "sg-08196272edcfe7ac9"  

addons:
- name: eks-pod-identity-agent
